!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.yayson=e():t.yayson=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=2)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t,e){var n=!0,r=!1,i=void 0;try{for(var o,u=Array.from(t)[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var a=o.value;if(e(a))return a}}catch(t){r=!0,i=t}finally{try{!n&&u.return&&u.return()}finally{if(r)throw i}}};e.default={find:r,filter:function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var u,a=Array.from(t)[Symbol.iterator]();!(r=(u=a.next()).done);r=!0){var s=u.value;e(s)&&n.push(s)}}catch(t){i=!0,o=t}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n},values:function(t){return null==t&&(t={}),Object.values(t)},any:function(t,e){return null!=r(t,e)},isPromise:function(t){return t===Object(t)&&"function"==typeof t.promiseDispatch&&"function"==typeof t.inspect}}},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(){r(this,t)}return i(t,null,[{key:"get",value:function(t,e){return e?t[e]:t}},{key:"id",value:function(t){var e=this.get(t,"id");return void 0===e?e:""+e}}]),t}();e.default=o},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.adapter;return{Store:o.default,Presenter:p({adapter:e}),Adapter:a.default}};var i=n(3),o=r(i),u=n(1),a=r(u),s=n(5),l=r(s),f=n(7),c=r(f),d=function(t){return"default"===t?a.default:l.default[t]||t||a.default},p=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,c.default)(d(t.adapter))}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(0),l=r(s),f=n(4),c=r(f),d=function(){function t(){o(this,t),this.reset()}return a(t,[{key:"reset",value:function(){this.records=[],this.relations={}}},{key:"toModel",value:function(t,e,n){var r=this,o=u({},t.attributes,{id:t.id,type:t.type});if(n[e]||(n[e]={}),n[e][t.id]||(n[e][t.id]=o),o.hasOwnProperty("meta")){var a=o,s=a.meta,l=i(a,["meta"]);o=u({},l,{attributes:{meta:s}})}if(t.meta&&(o.meta=t.meta),t.links&&(o.links=t.links),t.relationships)for(var f in t.relationships){var c=t.relationships[f],d=c.data,p=c.links,h=c.meta;if(o[f]=null,d||p){var v=function(t){var e=t.type,i=t.id;return r.find(e,i,n)};o[f]=d instanceof Array?d.map(v):d?v(d):{};var y=o[f];y&&(y._links=p||{},y._meta=h||{})}}return o}},{key:"findRecord",value:function(t,e){return l.default.find(this.records,function(n){return n.type===t&&n.id===e})}},{key:"findRecords",value:function(t){return l.default.filter(this.records,function(e){return e.type===t})}},{key:"find",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.findRecord(t,e);return r?(n[t]=n[t]||{},n[t][e]||this.toModel(r,t,n)):null}},{key:"findAll",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.findRecords(t);return r?(r.forEach(function(r){return n[t]=n[t]||{},e.toModel(r,t,n)}),l.default.values(n[t])):[]}},{key:"remove",value:function(t,e){var n=this,r=function(t){var e=n.records.indexOf(t);if(e>-1)return n.records.splice(e,1)};return e?r(this.findRecord(t,e)):this.findRecords(t).map(r)}},{key:"sync",value:function(t){var e=this,n=function(t){if(!t)return null;var n=function(t){var n=t.type,r=t.id;e.remove(n,r);var i=new c.default(t);return e.records.push(i),i};return t instanceof Array?t.map(n):n(t)};n(t.included);var r=n(t.data);if(!r)return null;var i={},o=null;return o=r instanceof Array?r.map(function(t){return e.toModel(t,t.type,i)}):this.toModel(r,r.type,i),t.hasOwnProperty("links")&&(o.links=t.links),t.hasOwnProperty("meta")&&(o.meta=t.meta),o}}]),t}();e.default=d},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function t(e){var n=e.id,i=e.type,o=e.attributes,u=e.relationships,a=e.links,s=e.meta;r(this,t),this.id=n,this.type=i,this.attributes=o,this.relationships=u,this.links=a,this.meta=s};e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(6),i=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default={sequelize:i.default}},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(1),s=function(t){return t&&t.__esModule?t:{default:t}}(a),l=function(t){function e(){return r(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),u(e,null,[{key:"get",value:function(t,e){if(null!=t)return t.get(e)}}]),e}(s.default);e.default=l},function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t){if(null!=t)return null!=t.self||null!=t.related?t:{self:t}}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();e.default=function(t){var e,n;return n=e=function(){function e(n){var r=this;i(this,e),this.adapter=t,this.id=function(t){return r.adapter.id(t)},null==n&&(n={}),this.scope=n}return u(e,null,[{key:"toJSON",value:function(){var t;return(t=new this).toJSON.apply(t,arguments)}},{key:"render",value:function(){var t;return(t=new this).render.apply(t,arguments)}}]),u(e,[{key:"selfLinks",value:function(){}},{key:"links",value:function(){}},{key:"relationships",value:function(){}},{key:"attributes",value:function(t){if(!t)return null;var e=this.adapter.get(t),n=(e.id,e.type,r(e,["id","type"])),i=this.relationships();for(var o in i)delete n[o];return n}},{key:"includeRelationships",value:function(t,e){var n=this.relationships(),r=[];for(var i in n){var o=n[i];if(!o)throw new Error("Presenter for "+i+" in "+this.constructor.type+" is not defined");var u=new o(t),a=this.adapter.get(e,i);a&&r.push(u.toJSON(a,{include:!0}))}}},{key:"buildRelationships",value:function(t){var e=this;if(!t)return null;var n=this.relationships(),r=this.links(t)||{},i=null;for(var u in n){var a;!function(){var s=e.adapter.get(t,u);a=n[u];var l=function(t){return{id:e.adapter.id(t),type:a.type}};i||(i={}),i=i||{},i[u]=i[u]||{},s instanceof Array?(i[u].data=s.map(l),r[u]&&(i[u].links=o(r[u]))):i[u]=function(t){var e={};return t&&(e.data=l(t)),r[u]?e.links=o(r[u]):t||(e.data=null),e}(s)}()}return i}},{key:"buildSelfLink",value:function(t){return o(this.selfLinks(t))}},{key:"toJSON",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n.meta&&(this.scope.meta=n.meta),this.scope.data||(this.scope.data=null),!t)return this.scope;if(t instanceof Array){var r=t;this.scope.data=this.scope.data||[],r.forEach(function(t){return e.toJSON(t,n)})}else{var i=t,o=!0,u={type:this.constructor.type,attributes:this.attributes(i)},a=this.id(i),l=this.buildRelationships(i),f=this.buildSelfLink(i);a&&(u.id=a),l&&(u.relationships=l),f&&(u.links=f),n.include?(this.scope.included=this.scope.included||[],s.default.any(this.scope.included.concat(this.scope.data),function(t){return t.id===u.id&&t.type===u.type})?o=!1:this.scope.included.push(u)):this.scope.data?this.scope.data instanceof Array&&s.default.any(this.scope.data,function(t){return t.id===u.id})?o=!1:this.scope.data.push(u):this.scope.data=u,o&&this.includeRelationships(this.scope,i)}return this.scope}},{key:"render",value:function(t,e){var n=this;return s.default.isPromise(t)?t.then(function(t){return n.toJSON(t,e)}):this.toJSON(t,e)}}]),e}(),e.type="objects",n};var a=n(0),s=function(t){return t&&t.__esModule?t:{default:t}}(a)}])});